# 📱 HabitBloom APK 打包指南（中文版）

## 🎯 快速开始

### Windows 用户（推荐使用 WSL）

#### 第一步：安装 WSL

1. 以**管理员身份**打开 PowerShell
2. 运行以下命令：
   ```powershell
   wsl --install -d Ubuntu-22.04
   ```
3. 重启电脑
4. 打开 Ubuntu，设置用户名和密码

#### 第二步：在 WSL 中打开项目

```bash
# 如果项目在 D:\笔记\副业\LLM_APP\HabitBloom
cd /mnt/d/笔记/副业/LLM_APP/HabitBloom

# 如果路径有中文导致问题，建议先复制到英文路径
# 例如：D:\Projects\HabitBloom
# 然后使用：
# cd /mnt/d/Projects/HabitBloom
```

#### 第三步：安装必要工具

```bash
# 更新系统
sudo apt update
sudo apt upgrade -y

# 安装基础工具
sudo apt install -y \
    python3 python3-pip python3-dev \
    build-essential git \
    openjdk-11-jdk \
    autoconf libtool pkg-config \
    libffi-dev libssl-dev zlib1g-dev \
    libsdl2-dev libsdl2-image-dev \
    libsdl2-mixer-dev libsdl2-ttf-dev

# 配置 Java
echo 'export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64' >> ~/.bashrc
echo 'export PATH=$JAVA_HOME/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

# 验证 Java
java -version
```

#### 第四步：安装 Buildozer

```bash
# 升级 pip
pip3 install --upgrade pip

# 安装 Buildozer
pip3 install buildozer cython

# 验证
buildozer --version
```

#### 第五步：检查环境（可选）

```bash
# 运行环境检查脚本
chmod +x check_env.sh
./check_env.sh
```

#### 第六步：开始打包

**方法 A：使用快速打包脚本（推荐）**

```bash
chmod +x quick_build.sh
./quick_build.sh
```

**方法 B：手动打包**

```bash
# 首次打包（会下载 Android SDK/NDK，需要 10-30 分钟）
buildozer android debug

# 如果中途失败，可以重新运行，会继续下载
```

#### 第七步：获取 APK

打包成功后，APK 文件在 `bin/` 目录：

```bash
# 查看 APK 文件
ls -lh bin/*.apk

# 复制到 Windows 目录（方便传输）
cp bin/*.apk /mnt/d/Downloads/habitbloom.apk
```

---

## 📲 安装到手机

### 步骤 1：传输 APK 到手机

- 使用 USB 数据线连接手机，复制 APK
- 或通过微信/QQ 发送到手机
- 或上传到网盘，在手机上下载

### 步骤 2：允许安装未知应用

**Android 设置**：
1. 打开「设置」
2. 找到「安全」或「应用管理」
3. 开启「允许安装未知来源应用」或「安装未知应用」
4. 选择您要使用的应用（文件管理器/浏览器）

**不同品牌设置位置**：
- **小米**：设置 → 应用设置 → 授权管理 → 安装未知应用
- **华为**：设置 → 安全 → 更多安全设置 → 外部来源应用下载
- **OPPO**：设置 → 其他设置 → 设备与隐私 → 安装未知应用
- **vivo**：设置 → 安全 → 安装未知应用

### 步骤 3：安装 APK

1. 在手机上找到 APK 文件
2. 点击 APK 文件
3. 点击「安装」
4. 等待安装完成
5. 点击「打开」启动应用

---

## ⚠️ 常见问题

### 问题 1：WSL 中无法访问中文路径

**解决方案**：
- 在 Windows 中将项目复制到纯英文路径
- 例如：`D:\Projects\HabitBloom`
- 然后在 WSL 中使用 `/mnt/d/Projects/HabitBloom`

### 问题 2：下载 Android SDK 失败

**解决方案**：
```bash
# 设置代理（如果有）
export http_proxy=http://127.0.0.1:7890
export https_proxy=http://127.0.0.1:7890

# 重新运行
buildozer android debug
```

### 问题 3：内存不足

**解决方案**：
```bash
# 限制内存使用
export GRADLE_OPTS="-Xmx2048m"

# 重新打包
buildozer android debug
```

### 问题 4：Java 版本错误

**解决方案**：
```bash
# 确保安装 JDK 11
sudo apt install openjdk-11-jdk

# 设置环境变量
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH

# 验证
java -version
```

### 问题 5：打包时间太长

**正常情况**：
- 首次打包：30-60 分钟（下载 SDK/NDK）
- 后续打包：10-20 分钟

如果超过 1 小时，可能是网络问题，建议：
- 检查网络连接
- 使用代理加速
- 重新运行（会继续下载，不会从头开始）

---

## 🔑 打包 Release 版本（用于发布）

如果要发布到应用商店：

### 步骤 1：生成签名密钥

```bash
mkdir -p ~/keystores
cd ~/keystores

keytool -genkey -v \
    -keystore habitbloom.keystore \
    -alias habitbloom \
    -keyalg RSA \
    -keysize 2048 \
    -validity 10000
```

**记住**：
- 密钥库密码
- 密钥别名：`habitbloom`
- 密钥密码（可以与密钥库密码相同）

### 步骤 2：配置 buildozer.spec

编辑 `buildozer.spec`，找到并修改：

```ini
android.keystore = ~/keystores/habitbloom.keystore
android.keyalias = habitbloom
```

### 步骤 3：打包 Release

```bash
buildozer android release
```

输入密钥库密码即可。

---

## 📊 打包检查清单

打包前确认：

- [ ] Python 3.8+ 已安装
- [ ] Java JDK 11+ 已安装
- [ ] Buildozer 已安装
- [ ] 在项目根目录（有 `main_kivy.py` 和 `buildozer.spec`）
- [ ] 网络连接稳定
- [ ] 至少有 8GB 可用磁盘空间
- [ ] 如果路径有中文，已复制到英文路径

---

## 🎉 完成！

打包成功后，您就可以在手机上使用 HabitBloom 了！

**需要帮助？**
- 查看详细文档：`APK_BUILD_GUIDE.md`
- 检查错误日志：`.buildozer/android/platform/build/dists/habitbloom/build.log`

祝您打包顺利！🌱
